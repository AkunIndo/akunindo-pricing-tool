<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AkunIndo Business Model Analysis</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.08);
        }
        
        .header h1 {
            font-size: 18px;
            margin: 0;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            background: #007bff;
            color: white;
        }
        
        .tab.updated {
            background: #28a745;
            color: white;
            animation: pulse 1s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .update-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 12px;
            height: 12px;
            font-size: 8px;
            display: none;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 30px;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 600px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .model-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }
        
        .model-card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .model-details {
            display: none;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }
        
        .model-details.expanded {
            display: block;
        }
        
        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
        }
        
        .input-group label {
            font-weight: 600;
            color: #34495e;
            margin-bottom: 5px;
            font-size: 13px;
        }
        
        .input-group input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .input-group small {
            color: #7f8c8d;
            margin-top: 3px;
            font-size: 12px;
        }
        
        .cost-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .cost-table th, .cost-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        
        .cost-table th {
            background: #f8f9fa;
            font-weight: 600;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .metric-card h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .metric .value {
            font-weight: 600;
        }
        
        .metric .value.positive { color: #27ae60; }
        .metric .value.negative { color: #e74c3c; }
        
        .recommendation {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        
        .advanced-toggle {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            margin: 10px 0;
        }
        
        .advanced-section {
            display: none;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .advanced-section.show {
            display: block;
        }
        
        .tooltip {
            position: relative;
            cursor: help;
        }
        
        .tooltip::after {
            content: '?';
            display: inline-block;
            width: 16px;
            height: 16px;
            background: #007bff;
            color: white;
            border-radius: 50%;
            text-align: center;
            font-size: 11px;
            line-height: 16px;
            margin-left: 5px;
        }
        
        .tooltip::before {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 1000;
            pointer-events: none;
        }
        
        .tooltip:hover::before {
            opacity: 1;
            visibility: visible;
        }
        
        /* Tooltip arrow */
        .tooltip:hover::after {
            background: #0056b3;
        }
        
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .success-highlight {
            background: #d1edff;
            border: 1px solid #74b9ff;
            border-left: 4px solid #0984e3;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .phased-strategy {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .phase-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #6c5ce7;
        }
        
        .phase-card ul, .stage-recommendation ul, .insight-card ul, .risk-card ul {
            margin-left: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        
        .phase-card li, .stage-recommendation li, .insight-card li, .risk-card li {
            margin-bottom: 6px;
            line-height: 1.4;
        }
        
        .stage-recommendation {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #00b894;
        }
        
        .early-stage { background: #e8f8f5; }
        .growth-stage { background: #fff8e1; }
        .scale-stage { background: #e3f2fd; }
        
        .market-analysis {
            background: #f1f2f6;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .insight-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        
        .insight-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #fd79a8;
        }
        
        .risk-mitigation {
            background: #ffeaa7;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .risk-card {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
        }
        
        .high-risk { border-left: 4px solid #e17055; }
        .medium-risk { border-left: 4px solid #fdcb6e; }
        
        .risk-card ul ul {
            margin-left: 20px;
            margin-top: 5px;
        }
        
        .risk-card ul ul li {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 4px;
        }
        
        /* Better spacing for card content */
        .phase-card h5, .stage-recommendation h4, .insight-card h5, .risk-card h5 {
            margin-bottom: 12px;
            margin-top: 0;
        }
        
        .phase-card p, .stage-recommendation p, .insight-card p, .risk-card p {
            margin-bottom: 8px;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            .input-grid {
                grid-template-columns: 1fr;
            }
            .results-grid {
                grid-template-columns: 1fr;
            }
            .insight-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>💡 AkunIndo Pricing Tool</h1>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('models')">💼 Business Models</button>
            <button class="tab" onclick="showTab('costs')">💰 Cost Analysis</button>
            <button class="tab" onclick="showTab('calculator')">🧮 Calculator</button>
            <button class="tab" onclick="showTab('results')" id="results-tab">
                📊 Results
                <span class="update-indicator" id="update-indicator">!</span>
            </button>
        </div>
        
        <!-- Tab 1: Business Models -->
        <div id="models" class="tab-content active">
            <h2>Pricing Model Options</h2>
            
            <div class="model-card">
                <h3 onclick="toggleModel('freemium')">
                    Model 1: Freemium with Receipt Limits
                    <span>▼</span>
                </h3>
                <div id="freemium" class="model-details">
                    <p><strong>Strategy:</strong> Classic SaaS model - free tier attracts users, premium features drive revenue. Free users get limited OCR processing (10 receipts/month), paid users get full features and higher limits.</p>
                    <p><strong>Business Analysis Insights:</strong> Target 10% free-to-paid conversion with 70% free users, 20% starter, 8% professional, 2% business distribution. Break-even at ~5,000 total users (500 paid). Sustainable margins of 60-77% once operational costs are optimized.</p>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Free → Paid Conversion Rate (%)</label>
                            <input type="number" id="freemium_conversion" value="10" min="0" max="100">
                            <small>Percentage of free users who upgrade</small>
                        </div>
                        <div class="input-group">
                            <label>Starter Price (IDR/month)</label>
                            <input type="number" id="freemium_starter" value="49000" step="1000">
                            <small>50 receipts/month, basic features</small>
                        </div>
                        <div class="input-group">
                            <label>Professional Price (IDR/month)</label>
                            <input type="number" id="freemium_pro" value="99000" step="1000">
                            <small>200 receipts/month, all features</small>
                        </div>
                        <div class="input-group">
                            <label>Business Price (IDR/month)</label>
                            <input type="number" id="freemium_business" value="199000" step="1000">
                            <small>Unlimited receipts, priority support</small>
                        </div>
                    </div>
                    <p><strong>Target Market:</strong> Growing SMEs who need predictable monthly costs and want to scale their usage over time.</p>
                    <p><strong>Pros:</strong> Predictable revenue, easy upselling, familiar model</p>
                    <p><strong>Cons:</strong> High customer acquisition cost, churn risk, free user infrastructure costs</p>
                </div>
            </div>
            
            <div class="model-card">
                <h3 onclick="toggleModel('bundle')">
                    Model 2: Pay-Per-Receipt Bundles
                    <span>▼</span>
                </h3>
                <div id="bundle" class="model-details">
                    <p><strong>Strategy:</strong> Prepaid credit system like mobile phone plans. Users buy "receipt packs" that don't expire quickly, aligning cost with actual usage. Better for irregular usage patterns.</p>
                    <p><strong>Business Analysis Insights:</strong> No monthly commitment reduces barrier for SMEs. Prepaid model improves cash flow with 70-80% margins. Average 2.5 packs/year per user = $4.30/user/year. Break-even at ~3,000 active users with better cost control.</p>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Active Users Rate (%)</label>
                            <input type="number" id="bundle_active" value="80" min="0" max="100">
                            <small>Percentage who purchase bundles</small>
                        </div>
                        <div class="input-group">
                            <label>Starter Pack (IDR)</label>
                            <input type="number" id="bundle_starter" value="29000" step="1000">
                            <small>30 receipts, 3mo validity</small>
                        </div>
                        <div class="input-group">
                            <label>Value Pack (IDR)</label>
                            <input type="number" id="bundle_value" value="79000" step="1000">
                            <small>100 receipts, 6mo validity</small>
                        </div>
                        <div class="input-group">
                            <label>Business Pack (IDR)</label>
                            <input type="number" id="bundle_business" value="149000" step="1000">
                            <small>250 receipts, 12mo validity</small>
                        </div>
                    </div>
                    <p><strong>Target Market:</strong> SMEs with seasonal or irregular receipt volumes who prefer to pay only when they need the service.</p>
                    <p><strong>Pros:</strong> Low commitment barrier, better cash flow, cost aligns with value</p>
                    <p><strong>Cons:</strong> Variable monthly revenue, complex pricing communication, potential revenue volatility</p>
                </div>
            </div>
            
            <div class="model-card">
                <h3 onclick="toggleModel('ecosystem')">
                    Model 3: Ecosystem Partnership
                    <span>▼</span>
                </h3>
                <div id="ecosystem" class="model-details">
                    <p><strong>Strategy:</strong> Core app is free or very cheap, revenue comes from partnerships with accounting software (Jurnal.id, Zoho), financial services (business loans, insurance), and educational content. Think "freemium app + referral marketplace".</p>
                    <p><strong>Business Analysis Insights:</strong> Diversified revenue reduces subscription dependency. Target $2.80/month ARPU from multiple streams. Break-even at ~2,000 users. Revenue includes: software partnerships ($0.50/user/mo), financial referrals ($20-50 per loan), educational content (30% commission), payment processing (0.1% volume).</p>
                    <div class="input-grid">
                        <div class="input-group">
                            <label>Premium Conversion (%)</label>
                            <input type="number" id="ecosystem_premium" value="30" min="0" max="100">
                            <small>Users paying for premium features</small>
                        </div>
                        <div class="input-group">
                            <label>Premium Price (IDR/month)</label>
                            <input type="number" id="ecosystem_price" value="39000" step="1000">
                            <small>Unlimited OCR, advanced exports</small>
                        </div>
                        <div class="input-group">
                            <label>Partnership Revenue ($/user/mo)</label>
                            <input type="number" id="ecosystem_partnership" value="0.50" step="0.10">
                            <small>Revenue share from integrations</small>
                        </div>
                        <div class="input-group">
                            <label>Referral Commission ($/user/mo)</label>
                            <input type="number" id="ecosystem_referral" value="0.60" step="0.10">
                            <small>Financial services referrals</small>
                        </div>
                    </div>
                    <p><strong>Partnership Examples:</strong> Export to Jurnal.id (revenue share), refer business loans (commission), sell accounting courses (affiliate fee), integrate with payment processors (transaction fees).</p>
                    <p><strong>Target Market:</strong> Maximum user base with diversified revenue streams, especially effective if we can build strong partnership network.</p>
                    <p><strong>Pros:</strong> Diversified revenue, low user barrier, value-added services, sustainable competitive moat</p>
                    <p><strong>Cons:</strong> Complex partnerships to negotiate, longer time to establish, revenue dependency on partners</p>
                </div>
            </div>
        </div>
        
        <!-- Tab 2: Cost Analysis -->
        <div id="costs" class="tab-content">
            <h2>Cost Structure Analysis</h2>
            
            <h3>Infrastructure Costs per User Type</h3>
            <table class="cost-table">
                <thead>
                    <tr>
                        <th>User Type</th>
                        <th>Receipts/Month</th>
                        <th>Database</th>
                        <th>OCR</th>
                        <th>Storage</th>
                        <th>Total Infra</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Light</td>
                        <td><input type="number" id="light_receipts" value="10" min="0" style="width:60px;padding:8px;border:2px solid #e0e0e0;border-radius:5px;font-size:14px;"></td>
                        <td>$<span id="light_db">0.05</span></td>
                        <td>$<span id="light_ocr">0.01</span></td>
                        <td>$<span id="light_storage">0.01</span></td>
                        <td><strong>$<span id="light_total">0.09</span></strong></td>
                    </tr>
                    <tr>
                        <td>Average</td>
                        <td><input type="number" id="avg_receipts" value="50" min="0" style="width:60px;padding:8px;border:2px solid #e0e0e0;border-radius:5px;font-size:14px;"></td>
                        <td>$<span id="avg_db">0.15</span></td>
                        <td>$<span id="avg_ocr">0.05</span></td>
                        <td>$<span id="avg_storage">0.05</span></td>
                        <td><strong>$<span id="avg_total">0.27</span></strong></td>
                    </tr>
                    <tr>
                        <td>Heavy</td>
                        <td><input type="number" id="heavy_receipts" value="200" min="0" style="width:60px;padding:8px;border:2px solid #e0e0e0;border-radius:5px;font-size:14px;"></td>
                        <td>$<span id="heavy_db">0.50</span></td>
                        <td>$<span id="heavy_ocr">0.20</span></td>
                        <td>$<span id="heavy_storage">0.20</span></td>
                        <td><strong>$<span id="heavy_total">0.92</span></strong></td>
                    </tr>
                </tbody>
            </table>
            
            <button class="advanced-toggle" onclick="toggleAdvanced('cost-advanced')">Show Advanced Cost Parameters</button>
            <div id="cost-advanced" class="advanced-section">
                <div class="input-grid">
                    <div class="input-group">
                        <label>OCR Cost ($/1000 pages)</label>
                        <input type="number" id="ocr_cost" value="1.0" step="0.1" min="0">
                    </div>
                    <div class="input-group">
                        <label>Database Cost ($/MB/month)</label>
                        <input type="number" id="db_cost" value="0.125" step="0.01" min="0">
                    </div>
                    <div class="input-group">
                        <label>Storage Cost ($/GB/month)</label>
                        <input type="number" id="storage_cost" value="0.021" step="0.001" min="0">
                    </div>
                    <div class="input-group">
                        <label>Support Cost ($/user/month)</label>
                        <input type="number" id="support_cost" value="0.50" step="0.05" min="0">
                    </div>
                    <div class="input-group">
                        <label>Development Cost ($/user/month)</label>
                        <input type="number" id="dev_cost" value="0.30" step="0.05" min="0">
                    </div>
                    <div class="input-group">
                        <label>Marketing Cost ($/user/month)</label>
                        <input type="number" id="marketing_cost" value="0.20" step="0.05" min="0">
                    </div>
                </div>
            </div>
            
            <h3>Operational Costs</h3>
            <div class="input-grid">
                <div class="input-group">
                    <label>Customer Support</label>
                    <input type="number" id="op_support" value="0.50" step="0.05">
                    <small>$/user/month</small>
                </div>
                <div class="input-group">
                    <label>Development & Maintenance</label>
                    <input type="number" id="op_dev" value="0.30" step="0.05">
                    <small>$/user/month (amortized)</small>
                </div>
                <div class="input-group">
                    <label>Marketing & Sales</label>
                    <input type="number" id="op_marketing" value="0.20" step="0.05">
                    <small>$/user/month</small>
                </div>
            </div>
            
            <div class="recommendation">
                <h4>Break-Even Analysis</h4>
                <p><strong>Minimum revenue needed:</strong> $<span id="breakeven">1.27</span>/user/month</p>
                <p><strong>Target margin:</strong> 70% (industry standard for SaaS)</p>
                <p><strong>Recommended ARPU:</strong> $<span id="target_arpu">4.23</span>/month</p>
            </div>
        </div>
        
        <!-- Tab 3: Calculator -->
        <div id="calculator" class="tab-content">
            <h2>Parameter Configuration</h2>
            
            <div class="input-grid">
                <div class="input-group">
                    <label>Total Customers</label>
                    <input type="number" id="total_customers" value="5000" min="0">
                </div>
                <div class="input-group">
                    <label>Exchange Rate (IDR/USD)</label>
                    <input type="number" id="exchange_rate" value="15250" min="0">
                </div>
            </div>
            
            <h3>User Distribution</h3>
            <div class="input-grid">
                <div class="input-group">
                    <label>Light Users (%)</label>
                    <input type="number" id="light_pct" value="30" min="0" max="100">
                </div>
                <div class="input-group">
                    <label>Average Users (%)</label>
                    <input type="number" id="avg_pct" value="50" min="0" max="100">
                </div>
                <div class="input-group">
                    <label>Heavy Users (%)</label>
                    <input type="number" id="heavy_pct" value="20" min="0" max="100">
                </div>
            </div>
            
            <div id="calc_results" class="results-grid">
                <!-- Results will be populated here -->
            </div>
        </div>
        
        <!-- Tab 4: Results -->
        <div id="results" class="tab-content">
            <h2>Model Comparison & Recommendations</h2>
            
            <div id="model_comparison" class="results-grid">
                <!-- Model comparison will be populated here -->
            </div>
            
            <div class="recommendation">
                <h4>Strategic Recommendations</h4>
                <div id="recommendations">
                    <!-- Recommendations will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentCalculations = {};
        
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            if (tabName === 'results') {
                updateResults();
                // Clear the update indicator when viewing results
                const indicator = document.getElementById('update-indicator');
                const resultsTab = document.getElementById('results-tab');
                indicator.style.display = 'none';
                resultsTab.classList.remove('updated');
            }
        }
        
        function markResultsUpdated() {
            const currentTab = document.querySelector('.tab.active');
            const resultsTab = document.getElementById('results-tab');
            const indicator = document.getElementById('update-indicator');
            
            // Only show indicator if we're not currently on the results tab
            if (currentTab.textContent.trim() !== 'Results') {
                indicator.style.display = 'block';
                resultsTab.classList.add('updated');
                
                // Auto-hide after 3 seconds
                setTimeout(() => {
                    if (!resultsTab.classList.contains('active')) {
                        indicator.style.display = 'none';
                        resultsTab.classList.remove('updated');
                    }
                }, 3000);
            }
        }
        
        function toggleModel(modelId) {
            const details = document.getElementById(modelId);
            const isExpanded = details.classList.contains('expanded');
            
            details.classList.toggle('expanded');
            const arrow = details.previousElementSibling.querySelector('span');
            arrow.textContent = isExpanded ? '▼' : '▲';
        }
        
        function toggleAdvanced(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('show');
            
            const button = event.target;
            button.textContent = section.classList.contains('show') 
                ? 'Hide Advanced Parameters' 
                : 'Show Advanced Parameters';
        }
        
        function updateCosts() {
            const ocrCost = parseFloat(document.getElementById('ocr_cost').value);
            const dbCostPerMB = parseFloat(document.getElementById('db_cost').value);
            const storageCostPerGB = parseFloat(document.getElementById('storage_cost').value);
            
            const userTypes = ['light', 'avg', 'heavy'];
            
            userTypes.forEach(type => {
                const receipts = parseInt(document.getElementById(`${type}_receipts`).value);
                
                // Calculate costs based on business analysis
                const ocrCost_user = (receipts * ocrCost) / 1000;
                
                // Database cost: includes metadata + processed data
                let dbCost_user;
                if (type === 'light') {
                    dbCost_user = 0.05; // Fixed cost from analysis
                } else if (type === 'avg') {
                    dbCost_user = 0.15; // Fixed cost from analysis  
                } else if (type === 'heavy') {
                    dbCost_user = 0.50; // Fixed cost from analysis
                }
                
                // Storage cost: includes hosting, bandwidth, image storage
                let storageCost_user;
                if (type === 'light') {
                    storageCost_user = 0.01 + 0.02; // Storage + hosting from analysis
                } else if (type === 'avg') {
                    storageCost_user = 0.05 + 0.02; // Storage + hosting from analysis
                } else if (type === 'heavy') {
                    storageCost_user = 0.20 + 0.02; // Storage + hosting from analysis
                }
                
                const totalCost = ocrCost_user + dbCost_user + storageCost_user;
                
                // Update display
                document.getElementById(`${type}_ocr`).textContent = ocrCost_user.toFixed(3);
                document.getElementById(`${type}_db`).textContent = dbCost_user.toFixed(3);
                document.getElementById(`${type}_storage`).textContent = storageCost_user.toFixed(3);
                document.getElementById(`${type}_total`).textContent = totalCost.toFixed(3);
            });
            
            updateBreakeven();
        }
        
        function updateBreakeven() {
            const opCosts = parseFloat(document.getElementById('op_support').value) +
                           parseFloat(document.getElementById('op_dev').value) +
                           parseFloat(document.getElementById('op_marketing').value);
            
            const avgInfraCost = parseFloat(document.getElementById('avg_total').textContent);
            const breakeven = avgInfraCost + opCosts;
            const targetArpu = breakeven / 0.3; // 30% of revenue for costs
            
            document.getElementById('breakeven').textContent = breakeven.toFixed(2);
            document.getElementById('target_arpu').textContent = targetArpu.toFixed(2);
        }
        
        function calculateModels() {
            const totalCustomers = parseInt(document.getElementById('total_customers').value);
            const exchangeRate = parseFloat(document.getElementById('exchange_rate').value);
            
            // User distribution
            const lightPct = parseFloat(document.getElementById('light_pct').value) / 100;
            const avgPct = parseFloat(document.getElementById('avg_pct').value) / 100;
            const heavyPct = parseFloat(document.getElementById('heavy_pct').value) / 100;
            
            const lightUsers = Math.round(totalCustomers * lightPct);
            const avgUsers = Math.round(totalCustomers * avgPct);
            const heavyUsers = Math.round(totalCustomers * heavyPct);
            
            // Costs
            const lightCost = parseFloat(document.getElementById('light_total').textContent);
            const avgCost = parseFloat(document.getElementById('avg_total').textContent);
            const heavyCost = parseFloat(document.getElementById('heavy_total').textContent);
            const opCost = parseFloat(document.getElementById('breakeven').textContent);
            
            // Calculate each model
            const freemium = calculateFreemium(totalCustomers, exchangeRate, lightCost, avgCost, heavyCost, opCost);
            const bundle = calculateBundle(totalCustomers, exchangeRate, lightCost, avgCost, heavyCost, opCost);
            const ecosystem = calculateEcosystem(totalCustomers, exchangeRate, lightCost, avgCost, heavyCost, opCost);
            
            currentCalculations = { freemium, bundle, ecosystem };
            
            return { freemium, bundle, ecosystem };
        }
        
        function calculateFreemium(totalCustomers, exchangeRate, lightCost, avgCost, heavyCost, opCost) {
            const conversion = parseFloat(document.getElementById('freemium_conversion').value) / 100;
            const starterPrice = parseFloat(document.getElementById('freemium_starter').value) / exchangeRate;
            const proPrice = parseFloat(document.getElementById('freemium_pro').value) / exchangeRate;
            const businessPrice = parseFloat(document.getElementById('freemium_business').value) / exchangeRate;
            
            const paidUsers = Math.round(totalCustomers * conversion);
            const freeUsers = totalCustomers - paidUsers;
            
            // Tier distribution (assuming 60% starter, 30% pro, 10% business)
            const starterUsers = Math.round(paidUsers * 0.6);
            const proUsers = Math.round(paidUsers * 0.3);
            const businessUsers = Math.round(paidUsers * 0.1);
            
            const revenue = (starterUsers * starterPrice) + (proUsers * proPrice) + (businessUsers * businessPrice);
            const cost = (freeUsers * lightCost * 0.5) + (starterUsers * (lightCost + opCost)) + 
                        (proUsers * (avgCost + opCost)) + (businessUsers * (heavyCost + opCost));
            
            return {
                name: 'Freemium',
                revenue: revenue,
                cost: cost,
                profit: revenue - cost,
                margin: revenue > 0 ? ((revenue - cost) / revenue * 100) : 0,
                arpu: revenue / totalCustomers,
                users: { free: freeUsers, paid: paidUsers }
            };
        }
        
        function calculateBundle(totalCustomers, exchangeRate, lightCost, avgCost, heavyCost, opCost) {
            const activeRate = parseFloat(document.getElementById('bundle_active').value) / 100;
            const starterPack = parseFloat(document.getElementById('bundle_starter').value) / exchangeRate;
            const valuePack = parseFloat(document.getElementById('bundle_value').value) / exchangeRate;
            const businessPack = parseFloat(document.getElementById('bundle_business').value) / exchangeRate;
            
            const activeUsers = Math.round(totalCustomers * activeRate);
            
            // Bundle distribution and annual purchases
            const starterUsers = Math.round(activeUsers * 0.5);
            const valueUsers = Math.round(activeUsers * 0.35);
            const businessUsers = Math.round(activeUsers * 0.15);
            
            const annualRevenue = (starterUsers * starterPack * 4) + (valueUsers * valuePack * 3) + (businessUsers * businessPack * 2);
            const monthlyRevenue = annualRevenue / 12;
            
            const avgCostPerUser = (lightCost + avgCost + heavyCost) / 3 + opCost;
            const totalCost = activeUsers * avgCostPerUser;
            
            return {
                name: 'Bundle',
                revenue: monthlyRevenue,
                cost: totalCost,
                profit: monthlyRevenue - totalCost,
                margin: monthlyRevenue > 0 ? ((monthlyRevenue - totalCost) / monthlyRevenue * 100) : 0,
                arpu: monthlyRevenue / totalCustomers,
                users: { active: activeUsers, inactive: totalCustomers - activeUsers }
            };
        }
        
        function calculateEcosystem(totalCustomers, exchangeRate, lightCost, avgCost, heavyCost, opCost) {
            const premiumRate = parseFloat(document.getElementById('ecosystem_premium').value) / 100;
            const premiumPrice = parseFloat(document.getElementById('ecosystem_price').value) / exchangeRate;
            const partnershipRev = parseFloat(document.getElementById('ecosystem_partnership').value);
            const referralRev = parseFloat(document.getElementById('ecosystem_referral').value);
            
            const premiumUsers = Math.round(totalCustomers * premiumRate);
            const freeUsers = totalCustomers - premiumUsers;
            
            const subscriptionRevenue = premiumUsers * premiumPrice;
            const partnershipRevenue = totalCustomers * partnershipRev;
            const referralRevenue = totalCustomers * referralRev;
            
            const totalRevenue = subscriptionRevenue + partnershipRevenue + referralRevenue;
            const totalCost = (freeUsers * (lightCost * 0.7 + opCost * 0.5)) + (premiumUsers * (avgCost + opCost));
            
            return {
                name: 'Ecosystem',
                revenue: totalRevenue,
                cost: totalCost,
                profit: totalRevenue - totalCost,
                margin: totalRevenue > 0 ? ((totalRevenue - totalCost) / totalRevenue * 100) : 0,
                arpu: totalRevenue / totalCustomers,
                users: { free: freeUsers, premium: premiumUsers },
                breakdown: {
                    subscription: subscriptionRevenue,
                    partnership: partnershipRevenue,
                    referral: referralRevenue
                }
            };
        }
        
        function updateResults() {
            const models = calculateModels();
            displayModelComparison(models);
            generateRecommendations(models);
        }
        
        function displayModelComparison(models) {
            const container = document.getElementById('model_comparison');
            const exchangeRate = parseFloat(document.getElementById('exchange_rate').value) || 15250;
            let html = '';
            
            Object.values(models).forEach(model => {
                const isProfitable = model.profit > 0;
                const statusClass = isProfitable ? 'positive' : 'negative';
                
                html += `
                    <div class="metric-card">
                        <h4>${model.name} Model</h4>
                        <div class="metric">
                            <span>Monthly Revenue:</span>
                            <span class="value">$${formatNumber(model.revenue)} / Rp ${formatNumber(model.revenue * exchangeRate)}</span>
                        </div>
                        <div class="metric">
                            <span>Monthly Cost:</span>
                            <span class="value">$${formatNumber(model.cost)} / Rp ${formatNumber(model.cost * exchangeRate)}</span>
                        </div>
                        <div class="metric">
                            <span>Monthly Profit:</span>
                            <span class="value ${statusClass}">$${formatNumber(model.profit)} / Rp ${formatNumber(model.profit * exchangeRate)}</span>
                        </div>
                        <div class="metric">
                            <span>Profit Margin:</span>
                            <span class="value ${statusClass}">${model.margin.toFixed(1)}%</span>
                        </div>
                        <div class="metric">
                            <span><span class="tooltip" data-tooltip="Average Revenue Per User - monthly revenue divided by total customers">ARPU</span>:</span>
                            <span class="value">$${model.arpu.toFixed(2)} / Rp ${formatNumber(model.arpu * exchangeRate)}</span>
                        </div>
                        <div class="metric">
                            <span>Annual Profit:</span>
                            <span class="value ${statusClass}">$${formatNumber(model.profit * 12)} / Rp ${formatNumber(model.profit * 12 * exchangeRate)}</span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        
        function generateRecommendations(models) {
            const container = document.getElementById('recommendations');
            const totalCustomers = parseInt(document.getElementById('total_customers').value);
            const exchangeRate = parseFloat(document.getElementById('exchange_rate').value) || 15250;
            
            // Find best model
            const sortedModels = Object.values(models).sort((a, b) => b.profit - a.profit);
            const bestModel = sortedModels[0];
            
            // Count profitable models
            const profitableCount = Object.values(models).filter(m => m.profit > 0).length;
            
            let recommendations = '';
            
            if (profitableCount === 0) {
                recommendations += `
                    <div class="alert-warning">
                        <p><strong>⚠️ Warning:</strong> None of the models are currently profitable with these parameters.</p>
                        <p><strong>Critical Actions Required:</strong></p>
                        <ul>
                            <li><strong>Smart OCR Cost Management:</strong> Implement caching and batch processing during off-peak hours</li>
                            <li><strong>Storage Optimization:</strong> Use aggressive image compression and tiered storage (hot/cold)</li>
                            <li><strong>Pricing Strategy:</strong> Consider starting with $1.90 USD (Rp 29,000) minimum viable pricing</li>
                            <li><strong>Scale Strategy:</strong> Target 5,000+ users for economies of scale - aim for 10% free-to-paid conversion</li>
                        </ul>
                    </div>
                `;
            } else {
                recommendations += `
                    <div class="success-highlight">
                        <p><strong>✅ Best performing model:</strong> ${bestModel.name} with $${formatNumber(bestModel.profit)}/mo profit (${bestModel.margin.toFixed(1)}% margin)</p>
                        <p><strong>Annual profit potential:</strong> $${formatNumber(bestModel.profit * 12)} (Rp ${formatNumber(bestModel.profit * 12 * exchangeRate)})</p>
                    </div>
                `;
            }
            
            // Phase-based rollout strategy from business analysis
            recommendations += `
                <div class="phased-strategy">
                    <h4>📅 Recommended 3-Phase Launch Strategy</h4>
                    
                    <div class="phase-card">
                        <h5>Phase 1: Freemium Launch (Months 1-6)</h5>
                        <ul>
                            <li><strong>Target:</strong> 5,000 users with 10% conversion rate (500 paid users)</li>
                            <li><strong>Focus:</strong> Product-market fit validation and user acquisition</li>
                            <li><strong>Break-even threshold:</strong> ~500 paid users at current pricing</li>
                            <li><strong>Key metrics:</strong> Keep CAC under $5/user, target <5% monthly churn</li>
                        </ul>
                    </div>
                    
                    <div class="phase-card">
                        <h5>Phase 2: Optimize & Expand (Months 7-12)</h5>
                        <ul>
                            <li><strong>Target:</strong> 15,000 users with 15% paid conversion</li>
                            <li><strong>Strategy:</strong> A/B test Bundle model as alternative pricing option</li>
                            <li><strong>Additions:</strong> Annual discounts (20% off), partnership integrations</li>
                            <li><strong>Goal:</strong> Achieve sustainable unit economics and positive cash flow</li>
                        </ul>
                    </div>
                    
                    <div class="phase-card">
                        <h5>Phase 3: Ecosystem Growth (Year 2+)</h5>
                        <ul>
                            <li><strong>Target:</strong> 50,000 users with $3+ ARPU</li>
                            <li><strong>Revenue streams:</strong> Partnerships with Jurnal.id, Zoho Books, financial services</li>
                            <li><strong>Expansion:</strong> Team features, neighboring markets, educational content</li>
                            <li><strong>Sustainability:</strong> 3:1 LTV/CAC ratio, 70%+ gross margin maintained</li>
                        </ul>
                    </div>
                </div>
            `;
            
            // Customer size-specific recommendations
            if (totalCustomers < 2000) {
                recommendations += `
                    <div class="stage-recommendation early-stage">
                        <h4>🚀 Early Stage Strategy (Under 2,000 users)</h4>
                        <p><strong>Recommended approach:</strong> Start with Ecosystem model to minimize CAC while building partnerships</p>
                        <ul>
                            <li><strong>Core offering:</strong> Free app with 20 OCR receipts/month, funded by partnerships</li>
                            <li><strong>Immediate partnerships:</strong> Integration with Jurnal.id, Zoho Books for revenue share</li>
                            <li><strong>Risk mitigation:</strong> Diversified revenue reduces subscription dependency</li>
                            <li><strong>Break-even target:</strong> ~2,000 active users with partnership revenue</li>
                        </ul>
                    </div>
                `;
            } else if (totalCustomers < 10000) {
                recommendations += `
                    <div class="stage-recommendation growth-stage">
                        <h4>📈 Growth Stage Strategy (2,000-10,000 users)</h4>
                        <p><strong>Recommended approach:</strong> Freemium model for predictable revenue and easier scaling</p>
                        <ul>
                            <li><strong>Focus areas:</strong> Conversion optimization, user retention, feature expansion</li>
                            <li><strong>Pricing optimization:</strong> A/B test price points, introduce annual discounts</li>
                            <li><strong>Partnership integration:</strong> Add ecosystem revenue streams alongside subscriptions</li>
                            <li><strong>Target metrics:</strong> 15% conversion rate, $1.50+ ARPU</li>
                        </ul>
                    </div>
                `;
            } else {
                recommendations += `
                    <div class="stage-recommendation scale-stage">
                        <h4>⚡ Scale Stage Strategy (10,000+ users)</h4>
                        <p><strong>Recommended approach:</strong> Bundle model with established user base and higher conversion</p>
                        <ul>
                            <li><strong>Advantages:</strong> Lower commitment barrier, improved cash flow, usage-based pricing</li>
                            <li><strong>Implementation:</strong> Offer alongside existing subscriptions for user choice</li>
                            <li><strong>Target segments:</strong> SMEs with seasonal/irregular usage patterns</li>
                            <li><strong>Revenue stability:</strong> Prepaid model provides better cash flow management</li>
                        </ul>
                    </div>
                `;
            }
            
            // Indonesian market specific insights
            recommendations += `
                <div class="market-analysis">
                    <h4>🇮🇩 Indonesian Market Deep Insights</h4>
                    
                    <div class="insight-grid">
                        <div class="insight-card">
                            <h5>💰 Price Sensitivity Management</h5>
                            <ul>
                                <li><strong>Entry pricing:</strong> Start with Rp 29,000-49,000 range for market acceptance</li>
                                <li><strong>Payment flexibility:</strong> Offer annual discounts (20% off) and student/NGO pricing</li>
                                <li><strong>Local payment methods:</strong> Support GoPay, OVO, DANA, bank transfers</li>
                                <li><strong>Referral program:</strong> Leverage word-of-mouth culture with rewards</li>
                            </ul>
                        </div>
                        
                        <div class="insight-card">
                            <h5>🤝 Relationship-Based Business Culture</h5>
                            <ul>
                                <li><strong>Partnership strategy:</strong> Build relationships with local accounting firms</li>
                                <li><strong>Educational approach:</strong> Offer compliance guides and accounting courses</li>
                                <li><strong>Community building:</strong> WhatsApp groups for user support and engagement</li>
                                <li><strong>Trust building:</strong> Emphasize data security and local compliance</li>
                            </ul>
                        </div>
                        
                        <div class="insight-card">
                            <h5>⚡ SME Digital Adoption</h5>
                            <ul>
                                <li><strong>Mobile-first:</strong> Ensure excellent mobile app experience</li>
                                <li><strong>Simple onboarding:</strong> Minimize complexity, provide video tutorials</li>
                                <li><strong>WhatsApp integration:</strong> Receipt submission via WhatsApp Bot</li>
                                <li><strong>Offline capabilities:</strong> Manual entry option for areas with poor connectivity</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            // Risk mitigation strategies
            recommendations += `
                <div class="risk-mitigation">
                    <h4>🛡️ Risk Mitigation Strategies</h4>
                    
                    <div class="risk-card high-risk">
                        <h5>⚠️ High Priority Risks</h5>
                        <ul>
                            <li><strong>OCR Cost Overrun:</strong> 
                                <ul>
                                    <li>Implement smart caching for similar receipts</li>
                                    <li>Batch process during off-peak hours (30% cost saving)</li>
                                    <li>Consider local OCR for simple receipts (backup solution)</li>
                                </ul>
                            </li>
                            <li><strong>Storage Cost Escalation:</strong>
                                <ul>
                                    <li>Aggressive image compression (reduce by 60-70%)</li>
                                    <li>Implement tiered storage (hot/cold data separation)</li>
                                    <li>Automatic cleanup after user exports (retention policy)</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="risk-card medium-risk">
                        <h5>⚡ Medium Priority Risks</h5>
                        <ul>
                            <li><strong>Market Price Sensitivity:</strong>
                                <ul>
                                    <li>Flexible pricing with multiple payment options</li>
                                    <li>Value-based messaging focusing on tax compliance savings</li>
                                    <li>Partner with accounting firms for endorsement</li>
                                </ul>
                            </li>
                            <li><strong>Competition from Established Players:</strong>
                                <ul>
                                    <li>Focus on superior mobile experience and WhatsApp integration</li>
                                    <li>Build strong local partnerships and community</li>
                                    <li>Emphasize Indonesia-specific features and compliance</li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            `;
            
            container.innerHTML = recommendations;
        }
        
        function formatNumber(num) {
            if (num < 0) {
                return '(' + Math.abs(num).toLocaleString('en-US', { maximumFractionDigits: 0 }) + ')';
            }
            return num.toLocaleString('en-US', { maximumFractionDigits: 0 });
        }
        
        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners to all inputs
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    updateCosts();
                    markResultsUpdated(); // Show indicator when parameters change
                    if (document.getElementById('results').classList.contains('active')) {
                        updateResults();
                    }
                });
            });
            
            // Initialize calculations
            updateCosts();
            updateResults();
        });
        
        // Save/load parameters to localStorage
        function saveParameters() {
            try {
                const params = {};
                document.querySelectorAll('input[type="number"]').forEach(input => {
                    params[input.id] = input.value;
                });
                localStorage.setItem('akunindo_params', JSON.stringify(params));
            } catch (e) {
                console.log('localStorage not available');
            }
        }
        
        function loadParameters() {
            try {
                const saved = localStorage.getItem('akunindo_params');
                if (saved) {
                    const params = JSON.parse(saved);
                    Object.keys(params).forEach(key => {
                        const input = document.getElementById(key);
                        if (input) input.value = params[key];
                    });
                    updateCosts();
                }
            } catch (e) {
                console.log('localStorage not available');
            }
        }
        
        // Auto-save on change
        document.addEventListener('input', saveParameters);
        
        // Load on startup
        loadParameters();
    </script>
</body>
</html>